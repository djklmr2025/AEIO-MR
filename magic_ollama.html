<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Arkaios UI â€” Ollama</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto;max-width:920px;margin:24px auto;padding:0 16px;background:#0d0f0d;color:#e7efe7}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#133015;color:#bde7bd}
    textarea{width:100%;min-height:120px;border:1px solid #1d3a1f;background:#0f1f10;color:#e7efe7;border-radius:10px;padding:12px;font-size:15px}
    .row{display:flex;gap:8px;margin:10px 0;flex-wrap:wrap}
    button{background:#22c55e;color:black;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    button.secondary{background:#133015;color:#e7efe7}
    #out{white-space:pre-wrap;border:1px solid #1d3a1f;background:#0e1c0f;border-radius:10px;padding:12px;min-height:120px}
    .files{font-size:12px;color:#bde7bd}
  </style>
</head>
<body>
  <header>
    <h2 style="margin:0">Arkaios UI</h2>
    <span class="badge">Proveedor: Ollama (local)</span>
  </header>

  <div class="row">
    <input id="file" type="file" multiple />
    <button class="secondary" onclick="subir()">Subir adjuntos</button>
    <span id="files" class="files"></span>
  </div>

  <textarea id="msg" placeholder="Escribe tu mensaje..."></textarea>
  <div class="row">
    <button onclick="enviar()">Enviar</button>
    <button class="secondary" onclick="limpiar()">Limpiar chat</button>
  </div>

  <h4>Respuesta</h4>
  <div id="out"></div>

  <script>
    let attachments = [];

    async function subir(){
      const f = document.querySelector('#file');
      if(!f.files.length){ alert('Selecciona archivos'); return; }
      const fd = new FormData();
      for(const x of f.files) fd.append('files', x);
      const r = await fetch('/upload', { method:'POST', body:fd });
      const data = await r.json();
      if(data.files){
        attachments = data.files;
        document.querySelector('#files').textContent = data.files.map(x=>x.name).join(', ');
      }else{
        alert(data.error||'Error subiendo');
      }
    }

    async function enviar(){
      const mensaje = document.querySelector('#msg').value.trim();
      const r = await fetch('/chat', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ mensaje, attachments })
      });
      const data = await r.json();
      document.querySelector('#out').textContent = (data.respuesta || data.reply || data.error || JSON.stringify(data,null,2));
    }

    async function limpiar(){
      await fetch('/clear', {method:'POST'});
      document.querySelector('#out').textContent = '';
      attachments = [];
      document.querySelector('#files').textContent = '';
      document.querySelector('#msg').value = '';
    }
  </script>
</body>
</html>
